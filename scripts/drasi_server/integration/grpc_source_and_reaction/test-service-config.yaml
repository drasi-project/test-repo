# E2E Test Framework Test Service Configuration for gRPC Integration Test
# This configuration defines test repositories and test runs

# Data Store Configuration
data_store:
  data_store_path: ./test_data_cache              # Cache location (overridden by --data flag)
  delete_on_start: true                           # Clean cache before test starts
  delete_on_stop: true                            # Clean cache after test completes
  # For persistent cache across runs:
  # delete_on_start: false
  # delete_on_stop: false

  # Test Repository Definitions
  test_repos:
    # GitHub Test Repository (fetches test definitions from GitHub)
    - id: github_dev_repo                         # Unique repository identifier
      kind: GitHub                                # Repository type: GitHub or Local
      owner: drasi-project                        # GitHub organization/user
      repo: test-repo                             # GitHub repository name
      branch: query-host                          # Git branch to use
      root_path: dev_repo/drasi_server/integration # Path within repo to test files
      force_cache_refresh: true                  # Use cached test if available
      # Set to true to always fetch latest from GitHub:
      # force_cache_refresh: true

# Test Run Configuration
test_run_host:
  test_runs:
    # Test Run Instance
    - test_id: building_comfort_grpc              # Test file name (without .test extension)
      test_repo_id: github_dev_repo               # Which test repository to use
      test_run_id: test_run_001                   # Unique identifier for this test run

      # Sources from the Test Definition to include in this test run
      sources:
        - test_source_id: facilities-db           # References source in test definition
          start_mode: auto                        # Start immediately: auto, manual
          # Alternative start modes:
          # start_mode: manual                    # Wait for manual start via API

      # Query Configuration (usually empty - defined in test file)
      queries: []

      # Reactions from the Test Definition to include in this test run
      reactions:
        - test_reaction_id: building-comfort      # References reaction in test definition
          start_immediately: true                 # Start listening for results immediately
          # For manual start:
          # start_immediately: false

          # Output Loggers
          output_loggers:                         # What to log from this reaction
            - kind: PerformanceMetrics            # Log performance metrics (throughput, latency)
            - kind: JsonlFile                     # Log results to JSONL file
              max_lines_per_file: 5000
